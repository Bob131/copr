{% from "_helpers.html" import render_field %}

{% macro copr_form(form, view, copr = None) %}
  {# if using for updating, we need to pass name to url_for, but otherwise we need to pass nothing #}
  <form action="{% if copr %}{{ url_for(view, username = copr.owner.name, coprname = copr.name) }}{% else %}{{ url_for(view) }}{% endif %}" method=post class=add-entry>
    <dl>
      {{ form.csrf_token }}
      {{ render_field(form.id, hidden = True) }}
      {{ render_field(form.name) }}
      {{ render_field(form.release) }}
      {{ render_field(form.arches, size = 2) }}
      {{ render_field(form.repos, rows = 10, cols = 50) }}
      <dd><input type=submit value=Submit></dd>
    </dl>
  </form>
{% endmacro %}

{% macro copr_permissions_form(form, copr, permissions) %}
  {% if permissions %}
    <form action="{{ url_for('coprs_ns.copr_update_permissions', username = copr.owner.name, coprname = copr.name) }}" method=post>
      {{ form.csrf_token }}
      <table class=permissions-table>
        <tr><th>Username</th><th>Is Builder</th><th>Is Admin</th></tr>
        {% for perm in permissions %}
          <tr>
            <td>{{ perm.user.name }}</td>
            <td>
              {{ perm.copr_builder|perm_type_from_num }}
              {% if perm.copr_builder != 0 %}
                {{ form['copr_builder_{0}'.format(perm.user.id)] }}
              {% endif %}
            </td>
            <td>
              {{ perm.copr_admin|perm_type_from_num }}
              {% if perm.copr_admin != 0 %}
                {{ form['copr_admin_{0}'.format(perm.user.id)] }}
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </table>
      <dd><input type=submit value=Save></dd>
    </form>
  {% endif %}
{% endmacro %}

{% macro copr_build_form(form, view, copr) %}
    <form action="{{ url_for(view, username = copr.owner.name, coprname = copr.name) }}" method=post class=add-entry>
      <dl>
        {{ form.csrf_token }}
        {{ render_field(form.pkgs, rows = 10, cols = 50) }}
        {% if g.user.proven %}
          {{ render_field(form.memory_reqs) }}
          {{ render_field(form.timeout) }}
          {% else %} {# once we pass the hidden attribute, the field will just be hidden, it seems #}
          {{ render_field(form.memory_reqs, hidden = True) }}
          {{ render_field(form.timeout, hidden = True) }}
        {% endif %}
        <dd><input type=submit value=Submit></dd>
      </dl>
    </form>
{% endmacro %}

{% macro copr_build_cancel_form(build) %}
  {% if build.cancelable %}
    <form action="{{ url_for('coprs_ns.copr_cancel_build', username = build.copr.owner.name, coprname = build.copr.name, build_id = build.id)}}" method=post>
      <input type=submit value=Cancel>
    </form>
  {% endif %}
{% endmacro %}
