{% extends "coprs/detail.html" %}
{% from "coprs/detail/_builds_forms.html" import copr_build_cancel_form, copr_build_repeat_form, copr_build_delete_form %}
{% from "coprs/detail/_describe_source.html" import describe_source %}
{% from "coprs/detail/_describe_failure.html" import describe_failure %}
{% from "_helpers.html" import chroot_to_os_logo, build_state_text, build_state, copr_name %}
{% block title %}Module {{ module.id }} in {{ copr_name(copr) }}{% endblock %}

{% set selected_tab = "modules" %}

{%block project_breadcrumb %}
<li>
    <a href="">Modules</a>
</li>
<li class="active">
    {{ module.id }}
</li>
{%endblock%}

{% block detail_body %}

{% if copr.id != module.copr.id %}
  <h2 class="build-detail"> Module {{ module.id }} doesn't belong to this project. </h2>
  <p> It belongs to {{ module.ownername }}/{{ module.projectname }} </p>
{% else %}

<h2 class="page-title">Module #{{ module.id }} </h2>

<div class="row">


  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">General Information</h3>
      </div>
      <div class="panel-body">
        <dl class="dl-horizontal">
          <dt>Name:</dt>
          <dd>{{ module.name }}</dd>

          <dt>Stream:</dt>
          <dd>{{ module.stream }}</dd>

          <dt>Version:</dt>
          <dd>{{ module.version }}</dd>

          <dt>License:</dt>
          <dd></dd>

          <dt>Summary:</dt>
          <dd>{{ module.summary }}</dd>
        </dl>
      </div>
    </div>
  </div>

  {% set no_packages = 'No packages in module\'s %s' %}

  <div class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Filter</h3>
      </div>
      <div class="panel-body">
        <ul>
          {% for package in module.modulemd.filter.rpms %}
            <li>{{ package }}</li>
          {% else %}
            <p>{{ no_packages | format('filter')}}</p>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">API</h3>
      </div>
      <div class="panel-body">
        <ul>
        {% for package in module.modulemd.api.rpms %}
          <li>{{ package }}</li>
        {% else %}
          <p>{{ no_packages | format('API')}}</p>
        {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Profiles</h3>
      </div>
      <div class="panel-body">
        <ul>
          {% for name, profile in module.modulemd.profiles.items() %}
            <li>{{ name }}</li>
            <ul>
              {% for package in profile.rpms %}
                <li>{{ package }}</li>
              {% endfor %}
            </ul>
          {% else %}
            <p>No profiles in module</p>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">How to use</h3>
      </div>
      <div class="panel-body">
        <p>To start working with modules, you first need to get modularity-enabled packages from <code>@copr/copr</code>: </p>
        <div class="highlight autumn">
          <pre>dnf install dnf-plugins-core       <span class="c1"># provides basic `dnf copr` command to enable COPR repos</span>
dnf copr enable @copr/copr         <span class="c1"># contains necessary packages to work with modules</span>
dnf upgrade dnf-plugins-core       <span class="c1"># gives `dnf copr` command with modularity support</span>
dnf install python3-fm-dnf-plugin  <span class="c1"># provides `dnf module` command compatible with modulemd-1.0.2</span></pre>
        </div>

        <p>For <code>dnf module</code> documentation, see its <a href="https://pagure.io/fm-dnf-plugin">project page</a>.

        <p>Now to install the built module, please run following commands as root:</p>
        <div class="highlight autumn">
          <pre><span class="c1"># Add module repofile to your system, that is /etc/fm.modules.d</span>
dnf copr enable {{ module.copr.full_name }}

<span class="c1"># Install the module</span>
dnf module <span class="nb">enable</span> {{ module.name }}</pre>

        </div>
      </div>
    </div>
  </div>


  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-heading clearfix">
        <a href="{{ copr_url('coprs_ns.copr_module_raw', copr, id=module.id) }}" class="btn btn-default pull-right"><span class="pficon pficon-save"></span> Raw</a>
        <h3 class="panel-title">Modulemd</h3>
      </div>
      <div class="panel-body">
        <p class="text-muted"><span class="pficon pficon-info"></span> You may want to use this modulemd as a template and then submit it via Copr API or <code>copr-cli</code> to be build.</p>
        {{ yaml | safe }}
      </div>
    </div>
  </div>


</div>

<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/pygments-autumn.css') }}"/>

{% endif %}
{% endblock %}
